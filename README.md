# **sudoku-ilp**

``sudoku-ilp`` - Integer Linear Programming Sudoku Solver

* [Usage](#usage)
* [Files](#files)
    * [sudoku.py](#sudokupy)
    * [sudoku](#sudoku)
    * [sudoku.csv](#sudokucsv)
* [Examples](#examples)
* [About](#about)

## Usage

~~~sh
$ echo $SUDOKUPROBLEM | ./sudoku.py
$ (echo $SUDOKUPROBLEM1; ... ; echo $SUDOKUPROBLEMN) | ./sudoku.py
~~~

~~~
$ echo 013000002200000480000700019000900800700000020000300000002630900409070600001490008 | ./sudoku.py
913584762257169483648723519136942857795816324824357196572638941489271635361495278
~~~

## Files

### `sudoku.py`
* A sudoku solver via the exact set cover problem, which is solved with 0/1-integer programming:
    * ~~~python
      def sudoku(givens, n=3):
          ...
          D = build_digits()
          R, C, B = build_rows_cols_blocks()
          RD = intersections(R, D)
          CD = intersections(C, D)
          BD = intersections(B, D)
          Cells = build_cells()
          Knowns = build_knowns()
          A = np.vstack((RD.T, CD.T, BD.T, Cells.T, Knowns))
          b = ones((A.shape[0],1))
          c = zeros((A.shape[1],1))
          G = zeros((1,A.shape[1]))
          h = zeros((1,1))
          integer = set([])
          binary = set(range(A.shape[1]))
          _, x = milp(c, G, h, A=A, b=b, I=integer, B=binary)
          if x:
              x = np.squeeze(x).astype(dtype)
              x = from_indicator(x, nvals)
          return x
      ~~~
* The key technique to highlight here is that of computing the set
  of interesections of all pairs of sets in two set covers (which are
  not required to cover the entire element set), where the result and
  input set covers are represented as incidence matrices (where columns
  correspond to the sets and rows correspond to the elements). Note that
  I don't bother to remove columns of zeros (i.e. empty interesections)
  from the result because in the case of sudoku this never occurs. The
  function is repoduced here:
    * ~~~python
      def intersections(I, J):
          '''I, J incidence matrices.'''
          assert(I.shape[0] == J.shape[0])
          return np.array([u * v for u, v in itertools.product(I.T, J.T)]).T
      ~~~

### `sudoku`
* A shell script which filters the garbage printed by the following bug present on some versions of `glpk`:
    * **NOTE[glpk]**: Some versions of glpk have a bug (which has been
      reported) where you can't prevent it from printing "Long-step dual
      simplex will be used" to stdout. So, if your glpk also has this bug
      and you want to make use of the stdout of this program, you need to do
      `... | ./sudoku.py | grep -vE "^Long"` or equivalent.
* ~~~sh
  #!/bin/sh
  BINDIR=.
  ${BINDIR}/sudoku.py "$@" | grep -vE "^Long"
  exit 0
  ~~~

### `sudoku.csv`
* A csv containing some test problems (column one) and their solutions (column two).

## Examples

* ~~~
  [m@night sudoku-ilp]$ echo 013000002200000480000700019000900800700000020000300000002630900409070600001490008 | ./sudoku.py
  913584762257169483648723519136942857795816324824357196572638941489271635361495278
  [m@night sudoku-ilp]$ echo 000000000008004010004070000800300069007100004095000000400510703070800900500006080 | ./sudoku.py
  Long-step dual simplex will be used
  712983645938654217654271398841327569267195834395468172486519723173842956529736481

  [m@night sudoku-ilp]$ echo 013000002200000480000700019000900800700000020000300000002630900409070600001490008 | ./sudoku
  913584762257169483648723519136942857795816324824357196572638941489271635361495278
  [m@night sudoku-ilp]$ echo 000000000008004010004070000800300069007100004095000000400510703070800900500006080 | ./sudoku
  712983645938654217654271398841327569267195834395468172486519723173842956529736481

  [m@night sudoku-ilp]$ cat sudoku.csv | cut -d, -f1 | ./sudoku.py
  913584762257169483648723519136942857795816324824357196572638941489271635361495278
  529478631418653297367129458846532719275914386193786524982347165654291873731865942
  Long-step dual simplex will be used
  712983645938654217654271398841327569267195834395468172486519723173842956529736481
  264159738381724956795683412426538179913276584857491263138947625642815397579362841
  Long-step dual simplex will be used
  512673489978142563463859712321795648859426371746381295237914856185267934694538127
  946712583718359246532648197193486752485273619627195834351967428869524371274831965
  697852341451639278382417659873265914145973826269148735714396582938521467526784193
  142895367893627415756413829685249731371568942429371586238756194514932678967184253
  456237918931486572287591436513648729629375184874129653762953841395814267148762395
  Long-step dual simplex will be used
  756981234921364578438572691819453726673218945542697183285139467197846352364725819

  [m@night sudoku-ilp]$ cat sudoku.csv | cut -d, -f1 | ./sudoku
  913584762257169483648723519136942857795816324824357196572638941489271635361495278
  529478631418653297367129458846532719275914386193786524982347165654291873731865942
  712983645938654217654271398841327569267195834395468172486519723173842956529736481
  264159738381724956795683412426538179913276584857491263138947625642815397579362841
  512673489978142563463859712321795648859426371746381295237914856185267934694538127
  946712583718359246532648197193486752485273619627195834351967428869524371274831965
  697852341451639278382417659873265914145973826269148735714396582938521467526784193
  142895367893627415756413829685249731371568942429371586238756194514932678967184253
  456237918931486572287591436513648729629375184874129653762953841395814267148762395
  756981234921364578438572691819453726673218945542697183285139467197846352364725819
  ~~~

* ~~~
  [m@night sudoku-ilp]$ TZ=UTC date
  Thu Apr 11 06:40:59 UTC 2019
  [m@night sudoku-ilp]$ ls -lh
  total 36K
  -rw-rw-r--. 1 m m  12K Apr 11 01:38 README.md
  -rw-rw-r--. 1 m m 1.7K Apr 11 01:37 sudoku.csv
  -rw-rw-r--. 1 m m 1.6K Apr 11 01:36 LICENSE
  -rwxr-xr-x. 1 m m   70 Apr 11 01:01 sudoku
  -rwxr-xr-x. 1 m m 8.5K Jan  9 01:34 sudoku.py
  [m@night sudoku-ilp]$ cat sudoku.csv
  013000002200000480000700019000900800700000020000300000002630900409070600001490008,913584762257169483648723519136942857795816324824357196572638941489271635361495278
  500070600410053007067120008840000010000010306000700020000000065000000870030000000,529478631418653297367129458846532719275914386193786524982347165654291873731865942
  000000000008004010004070000800300069007100004095000000400510703070800900500006080,712983645938654217654271398841327569267195834395468172486519723173842956529736481
  060050030001020050700003400426038000003000000057401200000007000000810007000060001,264159738381724956795683412426538179913276584857491263138947625642815397579362841
  000600409008000000003009000001705000800000001040300000030000056100000030094008007,512673489978142563463859712321795648859426371746381295237914856185267934694538127
  046000580718000006500040000100006750080000010020005804000007400069000070200001000,946712583718359246532648197193486752485273619627195834351967428869524371274831965
  600000001000630000082410009000005010040000000209008005004000080000020460500000000,697852341451639278382417659873265914145973826269148735714396582938521467526784193
  002805007090027400000010009080000731300000000400071000000000004010900000000000253,142895367893627415756413829685249731371568942429371586238756194514932678967184253
  400007910000400000200500036503000020000070100070129000000903000305000060000060000,456237918931486572287591436513648729629375184874129653762953841395814267148762395
  000000004901060500008000090800403706000010000540007180000039007000040050000700810,756981234921364578438572691819453726673218945542697183285139467197846352364725819
  [m@night sudoku-ilp]$ cat sudoku.csv | cut -d, -f1
  013000002200000480000700019000900800700000020000300000002630900409070600001490008
  500070600410053007067120008840000010000010306000700020000000065000000870030000000
  000000000008004010004070000800300069007100004095000000400510703070800900500006080
  060050030001020050700003400426038000003000000057401200000007000000810007000060001
  000600409008000000003009000001705000800000001040300000030000056100000030094008007
  046000580718000006500040000100006750080000010020005804000007400069000070200001000
  600000001000630000082410009000005010040000000209008005004000080000020460500000000
  002805007090027400000010009080000731300000000400071000000000004010900000000000253
  400007910000400000200500036503000020000070100070129000000903000305000060000060000
  000000004901060500008000090800403706000010000540007180000039007000040050000700810
  [m@night sudoku-ilp]$ cat sudoku.csv | cut -d, -f2
  913584762257169483648723519136942857795816324824357196572638941489271635361495278
  529478631418653297367129458846532719275914386193786524982347165654291873731865942
  712983645938654217654271398841327569267195834395468172486519723173842956529736481
  264159738381724956795683412426538179913276584857491263138947625642815397579362841
  512673489978142563463859712321795648859426371746381295237914856185267934694538127
  946712583718359246532648197193486752485273619627195834351967428869524371274831965
  697852341451639278382417659873265914145973826269148735714396582938521467526784193
  142895367893627415756413829685249731371568942429371586238756194514932678967184253
  456237918931486572287591436513648729629375184874129653762953841395814267148762395
  756981234921364578438572691819453726673218945542697183285139467197846352364725819
  [m@night sudoku-ilp]$ cat sudoku.csv | cut -d, -f1 | ./sudoku
  913584762257169483648723519136942857795816324824357196572638941489271635361495278
  529478631418653297367129458846532719275914386193786524982347165654291873731865942
  712983645938654217654271398841327569267195834395468172486519723173842956529736481
  264159738381724956795683412426538179913276584857491263138947625642815397579362841
  512673489978142563463859712321795648859426371746381295237914856185267934694538127
  946712583718359246532648197193486752485273619627195834351967428869524371274831965
  697852341451639278382417659873265914145973826269148735714396582938521467526784193
  142895367893627415756413829685249731371568942429371586238756194514932678967184253
  456237918931486572287591436513648729629375184874129653762953841395814267148762395
  756981234921364578438572691819453726673218945542697183285139467197846352364725819
  [m@night sudoku-ilp]$ paste <(cat sudoku.csv | cut -d, -f2) <(cat sudoku.csv | cut -d, -f1 | ./sudoku)
  913584762257169483648723519136942857795816324824357196572638941489271635361495278	913584762257169483648723519136942857795816324824357196572638941489271635361495278
  529478631418653297367129458846532719275914386193786524982347165654291873731865942	529478631418653297367129458846532719275914386193786524982347165654291873731865942
  712983645938654217654271398841327569267195834395468172486519723173842956529736481	712983645938654217654271398841327569267195834395468172486519723173842956529736481
  264159738381724956795683412426538179913276584857491263138947625642815397579362841	264159738381724956795683412426538179913276584857491263138947625642815397579362841
  512673489978142563463859712321795648859426371746381295237914856185267934694538127	512673489978142563463859712321795648859426371746381295237914856185267934694538127
  946712583718359246532648197193486752485273619627195834351967428869524371274831965	946712583718359246532648197193486752485273619627195834351967428869524371274831965
  697852341451639278382417659873265914145973826269148735714396582938521467526784193	697852341451639278382417659873265914145973826269148735714396582938521467526784193
  142895367893627415756413829685249731371568942429371586238756194514932678967184253	142895367893627415756413829685249731371568942429371586238756194514932678967184253
  456237918931486572287591436513648729629375184874129653762953841395814267148762395	456237918931486572287591436513648729629375184874129653762953841395814267148762395
  756981234921364578438572691819453726673218945542697183285139467197846352364725819	756981234921364578438572691819453726673218945542697183285139467197846352364725819
  [m@night sudoku-ilp]$ cmp <(cat sudoku.csv | cut -d, -f2) <(cat sudoku.csv | cut -d, -f1 | ./sudoku)
  [m@night sudoku-ilp]$
  ~~~

## About

Copyright © 2019, [Matthew Morrow](https://github.com/moonpatio).

Released under the [BSD2 license](LICENSE).
